<!DOCTYPE html>
<html>

<head>
  <title>Phân công lịch trực</title>
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
    }

    th,
    td {
      padding: 8px;
      text-align: left;
      border: 1px solid #ddd;
      text-align: center;
    }

    th {
      background-color: #f2f2f2;
    }

    h2 {
      text-align: center;
      margin: 20px 0;
    }
  </style>
</head>

<body>
  <h2>Thống kê ngày trực</h2>
  <table id="myTable">
    <thead>
      <tr>
        <th>Tên</th>
        <th>Thứ 2 - Thứ 6</th>
        <th>Thứ 7 (Sáng)</th>
        <th>Thứ 7 (Chiều)</th>
        <th>Thứ 7 (Tối)</th>
        <th>Chủ Nhật (Sáng)</th>
        <th>Chủ Nhật (Chiều)</th>
        <th>Chủ Nhật (Tối)</th>
        <th>Tổng Giờ Trực</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    fetch('https://docs.google.com/spreadsheets/d/1StDAeGsPGsz6g94QAAT4MkxNGJib_-77KZT3lmrSYgo/export?format=csv')
      .then(response => response.text())
      .then(data => {
        const rows = data.trim().split('\n');
        const tableBody = document.querySelector('#myTable tbody');

        const shiftStats = {};

        rows.slice(1).forEach(row => {
          const [name, date, day, shift, hours] = row.split(',');
          const totalHours = calculateTotalHours(shift, hours);

          if (!shiftStats[name]) {
            shiftStats[name] = {
              'Mon-Fri': 0,
              'Sat (Morning)': 0,
              'Sat (Afternoon)': 0,
              'Sat (Evening)': 0,
              'Sun (Morning)': 0,
              'Sun (Afternoon)': 0,
              'Sun (Evening)': 0,
              'Total': 0
            };
          }

          if (['Thứ 2', 'Thứ 3', 'Thứ 4', 'Thứ 5', 'Thứ 6'].includes(day)) {
            shiftStats[name]['Mon-Fri'] += parseFloat(totalHours);
          } else if (day === 'Thứ 7') {
            if (shift.includes('Sáng')) {
              shiftStats[name]['Sat (Morning)'] += parseFloat(totalHours);
            } else if (shift.includes('Chiều')) {
              shiftStats[name]['Sat (Afternoon)'] += parseFloat(totalHours);
            } else if (shift.includes('Tối')) {
              shiftStats[name]['Sat (Evening)'] += parseFloat(totalHours);
            }
          } else if (day === 'Chủ Nhật') {
            if (shift.includes('Sáng')) {
              shiftStats[name]['Sun (Morning)'] += parseFloat(totalHours);
            } else if (shift.includes('Chiều')) {
              shiftStats[name]['Sun (Afternoon)'] += parseFloat(totalHours);
            } else if (shift.includes('Tối')) {
              shiftStats[name]['Sun (Evening)'] += parseFloat(totalHours);
            }
          }

          shiftStats[name]['Total'] += parseFloat(totalHours);
        });

        Object.keys(shiftStats).forEach(name => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${name}</td>
            <td>${shiftStats[name]['Mon-Fri']}</td>
            <td>${shiftStats[name]['Sat (Morning)']}</td>
            <td>${shiftStats[name]['Sat (Afternoon)']}</td>
            <td>${shiftStats[name]['Sat (Evening)']}</td>
            <td>${shiftStats[name]['Sun (Morning)']}</td>
            <td>${shiftStats[name]['Sun (Afternoon)']}</td>
            <td>${shiftStats[name]['Sun (Evening)']}</td>
            <td>${shiftStats[name]['Total']}</td>
          `;
          tableBody.appendChild(tr);
        });
      })
      .catch(error => console.error(error));

    function calculateTotalHours(shift, hours) {
      const [start, end] = hours.split(' - ');
      const [startHour, startMinute] = start.split(':');
      const [endHour, endMinute] = end.split(':');

      const startTime = new Date();
      startTime.setHours(parseInt(startHour), parseInt(startMinute), 0, 0);

      const endTime = new Date();
      endTime.setHours(parseInt(endHour), parseInt(endMinute), 0, 0);

      const totalMilliseconds = endTime.getTime() - startTime.getTime();
      const totalHours = Math.floor(totalMilliseconds / (1000 * 60 * 60));

      return totalHours;
    }
  </script>
</body>

</html>