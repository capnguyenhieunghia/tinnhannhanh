<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lịch Trực Của Nhân Viên</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f2f2f2;
        }
    </style>
</head>

<body>
    <h1>Lịch Trực Của Nhân Viên</h1>
    <table id="shiftTable">
        <thead>
            <tr>
                <th>Tên</th>
                <th>Thứ Hai - Thứ Sáu</th>
                <th>Thứ Bảy Sáng</th>
                <th>Thứ Bảy Chiều</th>
                <th>Thứ Bảy Tối</th>
                <th>Chủ Nhật Sáng</th>
                <th>Chủ Nhật Chiều</th>
                <th>Chủ Nhật Tối</th>
                <th>Tổng Số Giờ</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        // Function to fetch data from the Google Sheets URL
        async function fetchShiftData() {
            const sheetUrl = 'https://docs.google.com/spreadsheets/d/1StDAeGsPGsz6g94QAAT4MkxNGJib_-77KZT3lmrSYgo/export?format=csv';
            const response = await fetch(sheetUrl);
            const data = await response.text();
            return data.split('\n').slice(1).map(row => row.split(','));
        }

        // Function to populate the shift table
        async function populateShiftTable() {
            const shiftData = await fetchShiftData();
            const employeeShifts = new Map();

            for (const row of shiftData) {
                const [name, date, dayShift, timeShift] = row;
                const [weekday, shiftTime] = parseShiftData(date, dayShift, timeShift);

                if (!employeeShifts.has(name)) {
                    employeeShifts.set(name, {
                        mondayToFriday: 0,
                        saturdayMorning: 0,
                        saturdayAfternoon: 0,
                        saturdayEvening: 0,
                        sundayMorning: 0,
                        sundayAfternoon: 0,
                        sundayEvening: 0,
                        totalHours: 0
                    });
                }

                const employeeData = employeeShifts.get(name);

                switch (weekday) {
                    case 'Thứ 2 - Thứ Sáu':
                        employeeData.mondayToFriday += 3;
                        employeeData.totalHours += 3;
                        break;
                    case 'Thứ 7', 'Sáng':
                        employeeData.saturdayMorning += 4;
                        employeeData.totalHours += 4;
                        break;
                    case 'Thứ 7 Chiều':
                        employeeData.saturdayAfternoon += 3;
                        employeeData.totalHours += 3;
                        break;
                    case 'Thứ 7 Tối':
                        employeeData.saturdayEvening += 3;
                        employeeData.totalHours += 3;
                        break;
                    case 'Chủ Nhật Sáng':
                        employeeData.sundayMorning += 4;
                        employeeData.totalHours += 4;
                        break;
                    case 'Chủ Nhật Chiều':
                        employeeData.sundayAfternoon += 3;
                        employeeData.totalHours += 3;
                        break;
                    case 'Chủ Nhật Tối':
                        employeeData.sundayEvening += 3;
                        employeeData.totalHours += 3;
                        break;
                }

                employeeShifts.set(name, employeeData);
            }

            const tableBody = document.getElementById('shiftTable').getElementsByTagName('tbody')[0];

            for (const [name, employeeData] of employeeShifts) {
                const rowElement = document.createElement('tr');

                const nameCell = document.createElement('td');
                nameCell.textContent = name;
                rowElement.appendChild(nameCell);

                const cellMap = {
                    'Thứ 2 - Thứ 6': 'mondayToFriday',
                    'Thứ 7 Sáng': 'saturdayMorning',
                    'Thứ 7 Chiều': 'saturdayAfternoon',
                    'Thứ 7 Tối': 'saturdayEvening',
                    'Chủ Nhật Sáng': 'sundayMorning',
                    'Chủ Nhật Chiều': 'sundayAfternoon',
                    'Chủ Nhật Tối': 'sundayEvening'
                };

                for (const [columnName, propertyName] of Object.entries(cellMap)) {
                    const cell = document.createElement('td');
                    cell.textContent = `${employeeData[propertyName]}`;
                    rowElement.appendChild(cell);
                }

                const totalHoursCell = document.createElement('td');
                totalHoursCell.textContent = `${employeeData.totalHours}`;
                rowElement.appendChild(totalHoursCell);

                tableBody.appendChild(rowElement);
            }
        }

        // Function to parse the shift data
        function parseShiftData(date, dayShift, timeShift) {
            const weekday = ['Thứ 2 - Thứ 6', 'Thứ 7 Sáng', 'Thứ 7 Chiều', 'Thứ 7 Tối', 'Chủ Nhật Sáng', 'Chủ Nhật Chiều', 'Chủ Nhật Tối'][new Date(date).getDay()];
            return [weekday, timeShift];
        }

        // Call the function to populate the shift table
        populateShiftTable();
    </script>
</body>

</html>