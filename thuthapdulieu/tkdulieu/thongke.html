<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thống kê</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div style="padding: 10px; background-color: #00008B; width: 100px; text-align: center;"><a
            href="../index.html" style="text-decoration: none; color: white; ">Quay lại</a></div>
    <div><a href="./themdl.html"
            style="text-decoration: none; padding: 10px; background-color: navy; position: absolute; right: 0; color: white;">Thêm, xóa, sửa dữ
            liệu</a></div>
    <div class="timkiem"><input type="text" id="searchInput" placeholder="Search by name, phone, or CCCD"></div>
    <table id="data-table">
        <thead>
            <tr>
                <th>Ngày lưu DL</th>
                <th>Họ và Tên</th>
                <th>Số Điện Thoại</th>
                <th>Ngày Sinh</th>
                <th>Giới tính</th>
                <th>Nơi sinh</th>
                <th>Dân tộc</th>
                <th>CCCD</th>
                <th>Ngày Cấp</th>
                <th>Nơi Cấp</th>
                <th>Tỉnh / Thành Phố</th>
                <th>Huyện</th>
                <th>Xã</th>
                <th>Địa Chỉ</th>
                <th>Email</th>
            </tr>
        </thead>
        <tbody id="data-rows"></tbody>
    </table>

    <table class="statistics-table">
        <thead>
            <tr>
                <th>Trường dữ liệu</th>
                <th>Tổng số</th>
                <th>Số lượng duy nhất</th>
            </tr>
        </thead>
        <tbody id="statistics-rows"></tbody>
    </table>
    <!--  -->
    <div class="tk1"><iframe src="./tktinh.html" frameborder="0" style="overflow:hidden;height:100%;width:100%"
            height="100%" width="100%"></iframe></div>
    <!--  -->
    <div class="tk2"><iframe src="./tkdt.html" frameborder="0" style="overflow:hidden;height:100%;width:100%"
            height="100%" width="100%"></iframe></div>
    <!--  -->
    <script>
        const GOOGLE_SHEETS_URL = 'https://docs.google.com/spreadsheets/d/1-ww__BSRX6a-Lq38sNaVSxnZJVph_1fgUyJz70FUQmI/export?format=csv';
        let allData = [];

        fetch(GOOGLE_SHEETS_URL)
            .then(response => response.text())
            .then(data => {
                const rows = data.trim().split('\n');
                const tableBody = document.getElementById('data-rows');
                const statisticsTableBody = document.getElementById('statistics-rows');

                const statistics = {
                    'Ngày lưu DL': [],
                    'Họ và Tên': [],
                    'Số Điện Thoại': [],
                    'Ngày Sinh': [],
                    'Giới tính': [],
                    'Nơi sinh': [],
                    'Dân tộc': [],
                    'CCCD': [],
                    'Ngày Cấp': [],
                    'Nơi Cấp': [],
                    'Tỉnh / Thành Phố': [],
                    'Huyện': [],
                    'Xã': [],
                    'Địa Chỉ': [],
                    'Email': []
                };

                rows.forEach((row, index) => {
                    if (index > 0) { // Skip the header row
                        const columns = row.split(',');
                        const rowData = {
                            'Ngày lưu DL': columns[0].trim(),
                            'Họ và Tên': columns[1].trim(),
                            'Số Điện Thoại': columns[2].trim(),
                            'Ngày Sinh': columns[3].trim(),
                            'Giới tính': columns[4].trim(),
                            'Nơi sinh': columns[5].trim(),
                            'Dân tộc': columns[6].trim(),
                            'CCCD': columns[7].trim(),
                            'Ngày Cấp': columns[8].trim(),
                            'Nơi Cấp': columns[9].trim(),
                            'Tỉnh / Thành Phố': columns[10].trim(),
                            'Huyện': columns[11].trim(),
                            'Xã': columns[12].trim(),
                            'Địa Chỉ': columns[13].trim(),
                            'Email': columns[14].trim()
                        };
                        allData.push(rowData);

                        const tr = document.createElement('tr');

                        for (const [key, value] of Object.entries(rowData)) {
                            const td = document.createElement('td');
                            td.textContent = value;
                            tr.appendChild(td);

                            statistics[key].push(value);
                        }

                        tableBody.appendChild(tr);
                    }
                });

                // Calculate and display statistics
                for (const [key, values] of Object.entries(statistics)) {
                    const uniqueValues = [...new Set(values)];
                    const totalCount = values.length;
                    const tr = document.createElement('tr');

                    const fieldTd = document.createElement('td');
                    fieldTd.textContent = key;
                    const totalTd = document.createElement('td');
                    totalTd.textContent = totalCount;
                    const uniqueTd = document.createElement('td');
                    uniqueTd.textContent = uniqueValues.length;

                    tr.appendChild(fieldTd);
                    tr.appendChild(totalTd);
                    tr.appendChild(uniqueTd);
                    statisticsTableBody.appendChild(tr);
                }

                // Add event listener for search input
                const searchInput = document.getElementById('searchInput');
                searchInput.addEventListener('input', () => {
                    const searchTerm = searchInput.value.toLowerCase();
                    const filteredData = allData.filter(row =>
                        row['Họ và Tên'].toLowerCase().includes(searchTerm) ||
                        row['Số Điện Thoại'].toLowerCase().includes(searchTerm) ||
                        row['CCCD'].toLowerCase().includes(searchTerm)
                    );

                    // Clear the table body
                    tableBody.innerHTML = '';

                    // Populate the table with filtered data
                    filteredData.forEach(row => {
                        const tr = document.createElement('tr');
                        for (const [key, value] of Object.entries(row)) {
                            const td = document.createElement('td');
                            td.textContent = value;
                            tr.appendChild(td);
                        }
                        tableBody.appendChild(tr);
                    });
                });
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });
    </script>
</body>

</html>