<!DOCTYPE html>
<html>

<head>
    <title>Thống kê sinh viên theo tỉnh thành</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 8px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }

        th {
            
            background-color: #f2f2f2;
        }

        .student-details-modal {
            display: none;
            width: 100%;
            max-height: 400px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: white;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .student-details-modal-content {
            background-color: #fefefe;
            width: 100%;
        }
    </style>
</head>

<body>
    <label for="province-filter">Lọc theo tỉnh/thành phố:</label>
    <select id="province-filter">
        <option value="">Tất cả</option>
    </select>
    <table id="student-table">
        <thead>
            <tr>
                <th>Tỉnh / Thành Phố</th>
                <th>Số lượng</th>
                <th>Xem chi tiết</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <div id="student-details-modal" class="student-details-modal">
        <div class="student-details-modal-content">
            <div class="student-details-table-container" >
                <table id="student-details-table">
                    <thead style="position: sticky; top: 0; background-color: #f2f2f2;">
                        <tr>
                            <th>Họ và tên</th>
                            <th>SĐT</th>
                            <th>Ngày Sinh</th>
                            <th>Giới tính</th>
                            <th>Nơi sinh</th>
                            <th>Dân tộc</th>
                            <th>CCCD</th>
                            <th>Ngày Cấp</th>
                            <th>Nơi Cấp</th>
                            <th>Địa chỉ</th>
                            <th>Huyện</th>
                            <th>Xã</th>
                            <th>Email</th>
                            <th>Tỉnh/Thành Phố</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Lấy dữ liệu từ Google Sheets
        fetch('https://docs.google.com/spreadsheets/d/1-ww__BSRX6a-Lq38sNaVSxnZJVph_1fgUyJz70FUQmI/export?format=csv')
            .then(response => response.text())
            .then(data => {
                // Tách dữ liệu thành từng hàng
                const rows = data.split('\n');

                // Tính số lượng sinh viên theo tỉnh thành
                const studentData = {};
                for (let i = 1; i < rows.length; i++) {
                    const cells = rows[i].split(',');
                    // Sửa lại thứ tự các thông tin sinh viên Họ và Tên	Số Điện Thoai	Ngày Sinh	Giới tính	Nơi sinh	Dân tộc	CCCD	Ngày Cấp	Nới Cấp	Tỉnh / Thành Phố	Huyện	Xã	Địa Chỉ	Email
                    const student = {
                        hvt: cells[1].trim(),
                        sdt: cells[2].trim(),
                        ngs: cells[3].trim(),
                        gt: cells[4].trim(),
                        ns: cells[5].trim(),
                        cot6: cells[6].trim(),
                        cot7: cells[7].trim(),
                        cot8: cells[8].trim(),
                        cot9: cells[9].trim(),
                        cot13: cells[13].trim(),
                        cot11: cells[11].trim(),
                        cot12: cells[12].trim(),
                        cot14: cells[14].trim(),
                        province: cells[10].trim()
                    };
                    if (student.province in studentData) {
                        studentData[student.province].push(student);
                    } else {
                        studentData[student.province] = [student];
                    }
                }

                // Tạo select box cho tỉnh/thành phố
                const provinceFilter = document.getElementById('province-filter');
                for (const province in studentData) {
                    const option = document.createElement('option');
                    option.value = province;
                    option.textContent = province;
                    provinceFilter.appendChild(option);
                }

                // Hiển thị thống kê
                const tableBody = document.getElementById('student-table').getElementsByTagName('tbody')[0];
                provinceFilter.addEventListener('change', () => {
                    // Xóa dữ liệu cũ trong bảng
                    while (tableBody.firstChild) {
                        tableBody.removeChild(tableBody.firstChild);
                    }

                    // Lọc và hiển thị dữ liệu mới
                    const selectedProvince = provinceFilter.value;
                    for (const province in studentData) {
                        if (selectedProvince === '' || province === selectedProvince) {
                            const row = document.createElement('tr');
                            const provinceCell = document.createElement('td');
                            provinceCell.textContent = province;
                            const countCell = document.createElement('td');
                            countCell.textContent = studentData[province].length;
                            const detailsCell = document.createElement('td');
                            const detailsButton = document.createElement('button');
                            detailsButton.textContent = 'Xem chi tiết';
                            detailsButton.addEventListener('click', () => showStudentDetails(studentData[province]));
                            detailsCell.appendChild(detailsButton);
                            row.appendChild(provinceCell);
                            row.appendChild(countCell);
                            row.appendChild(detailsCell);
                            tableBody.appendChild(row);
                        }
                    }
                });
            })
            .catch(error => console.error(error));

        // Hiển thị chi tiết sinh viên
        const modal = document.getElementById('student-details-modal');
        const closeButton = document.getElementsByClassName('close-button')[0];
        const detailsTable = document.getElementById('student-details-table').getElementsByTagName('tbody')[0];

        function showStudentDetails(students) {
            // Xóa dữ liệu cũ trong bảng chi tiết
            while (detailsTable.firstChild) {
                detailsTable.removeChild(detailsTable.firstChild);
            }

            // Hiển thị thông tin sinh viên
            for (const student of students) {
                const row = document.createElement('tr');
                const hvtCell = document.createElement('td');
                hvtCell.textContent = student.hvt;
                const sdtCell = document.createElement('td');
                sdtCell.textContent = student.sdt;
                const ngsCell = document.createElement('td');
                ngsCell.textContent = student.ngs;
                const gtCell = document.createElement('td');
                gtCell.textContent = student.gt;
                const nsCell = document.createElement('td');
                nsCell.textContent = student.ns;
                const cot6Cell = document.createElement('td');
                cot6Cell.textContent = student.cot6;
                const cot7Cell = document.createElement('td');
                cot7Cell.textContent = student.cot7;
                const cot8Cell = document.createElement('td');
                cot8Cell.textContent = student.cot8;
                const cot9Cell = document.createElement('td');
                cot9Cell.textContent = student.cot9;
                const cot13Cell = document.createElement('td');
                cot13Cell.textContent = student.cot13;
                const cot11Cell = document.createElement('td');
                cot11Cell.textContent = student.cot11;
                const cot12Cell = document.createElement('td');
                cot12Cell.textContent = student.cot12;
                const cot14Cell = document.createElement('td');
                cot14Cell.textContent = student.cot14;
                const provinceCell = document.createElement('td');
                provinceCell.textContent = student.province;
                row.appendChild(hvtCell);
                row.appendChild(sdtCell);
                row.appendChild(ngsCell);
                row.appendChild(gtCell);
                row.appendChild(nsCell);
                row.appendChild(cot6Cell);
                row.appendChild(cot7Cell);
                row.appendChild(cot8Cell);
                row.appendChild(cot9Cell);
                row.appendChild(cot13Cell);
                row.appendChild(cot11Cell);
                row.appendChild(cot12Cell);
                row.appendChild(cot14Cell);
                row.appendChild(provinceCell);
                detailsTable.appendChild(row);
            }

            modal.style.display = 'block';
        }

        closeButton.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        window.addEventListener('click', (event) => {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });
    </script>
</body>

</html>